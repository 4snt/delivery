generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("POSTGRES_PRISMA_URL") // Pooled connection for queries
  // Usando a mesma URL para migrations (defina POSTGRES_URL_NON_POOLING se preferir, mas não é obrigatório).
  directUrl = env("POSTGRES_PRISMA_URL")
}

model Adicional {
  id      BigInt           @id @default(autoincrement())
  nome    String
  pedidos PedidoAdicional[]
}

model Sabor {
  id      BigInt       @id @default(autoincrement())
  nome    String
  imagem  String
  pedidos PedidoSabor[]
}

model Cliente {
  id      BigInt    @id @default(autoincrement())
  email   String    @unique
  nome    String
  senha   String
  isAdmin Boolean   @default(false)
  pedidos Pedido[]
}

model Pedido {
  id             BigInt          @id @default(autoincrement())
  cliente        Cliente         @relation(fields: [clienteId], references: [id])
  clienteId      BigInt
  sabores        PedidoSabor[]
  adicionais     PedidoAdicional[]
  tamanho        String
  valorTotal     Float
  formaPagamento String
  enderecoEntrega String
  status         String          @default("Pendente")
  createdAt      DateTime        @default(now())
}

model PedidoSabor {
  pedido   Pedido @relation(fields: [pedidoId], references: [id], onDelete: Cascade)
  pedidoId BigInt
  sabor    Sabor  @relation(fields: [saborId], references: [id], onDelete: Cascade)
  saborId  BigInt

  @@id([pedidoId, saborId])
}

model PedidoAdicional {
  pedido      Pedido    @relation(fields: [pedidoId], references: [id], onDelete: Cascade)
  pedidoId    BigInt
  adicional   Adicional @relation(fields: [adicionalId], references: [id], onDelete: Cascade)
  adicionalId BigInt

  @@id([pedidoId, adicionalId])
}
